{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">ðŸš¨ Anomalous {{ data_type|title }} (Low Similarity)</h2>

  <p class="text-muted">Threshold: similarity &lt; {{ threshold }}</p>
  <p class="text-muted"><b>NOTE:These articles are unusual and might relate to systems like these â€” please investigate</b></p>

  {% if records %}
    {% for r in records %}
      <div class="card mb-4">
        <div class="card-header bg-warning-subtle">
          <strong>{{ r.title|default:"Unlabeled Entry" }}</strong>
        </div>
        <div class="card-body">
          <p>{{ r.content|truncatechars:300 }}</p>

          {% for label in taxonomy %}
            {% if label.record_id == "Article:"|add:r.id|stringformat:"s" %}
              <h6 class="mt-3">ðŸ§  Taxonomy Tags:</h6>
              <ul>
                <li><strong>Impact:</strong> {{ label.impact|join:", " }}</li>
                <li><strong>Actor:</strong> {{ label.actor|join:", " }}</li>
                <li><strong>Platform:</strong> {{ label.platform|join:", " }}</li>
              </ul>
              {% endif %}

          {% endfor %}

          {% if assets %}
            <h6 class="mt-3">ðŸ’» Potentially Affected Assets:</h6>
            <ul>
              {% for a in assets %}
                <li>{{ a.asset_type }} â€” {{ a.platform }} @ {{ a.city }}, {{ a.country }} ({{ a.employee_email }})</li>
              {% endfor %}
            </ul>
          {% else %}
            <p><em>No matching internal assets found for the taxonomy.</em></p>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p class="text-muted">âœ… No anomalies found below similarity threshold.</p>
  {% endif %}
</div>
{% endblock %}
